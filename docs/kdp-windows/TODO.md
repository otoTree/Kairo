# KDP çª—å£æ¸²æŸ“ â€” è®¾è®¡ä¸å®ç° TODO

> åŸºäºç°æœ‰å®ç°çŠ¶æ€å’Œè§„èŒƒæ–‡æ¡£ï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åˆ—ã€‚
> çŠ¶æ€æ ‡è®°ï¼šâ¬œ æœªå¼€å§‹ | ğŸ”² è¿›è¡Œä¸­ | âœ… å·²å®Œæˆ

---

## Phase 1ï¼šKDP æ¸²æŸ“å™¨å¢å¼ºï¼ˆZig å±‚ï¼‰

åŸºç¡€æ¸²æŸ“èƒ½åŠ›æ˜¯æ‰€æœ‰çª—å£çš„å‰æã€‚

| # | ä»»åŠ¡ | çŠ¶æ€ | æ–‡ä»¶ | è¯´æ˜ |
|---|------|------|------|------|
| 1.1 | `rect` èŠ‚ç‚¹æ·»åŠ  `radius` å±æ€§ | â¬œ | `os/src/shell/river/KairoDisplay.zig` | åœ†è§’çŸ©å½¢ï¼Œçª—å£/å¡ç‰‡/æŒ‰é’®éƒ½ä¾èµ–æ­¤åŠŸèƒ½ |
| 1.2 | `rect` èŠ‚ç‚¹æ·»åŠ  `border` å±æ€§ | â¬œ | `os/src/shell/river/KairoDisplay.zig` | æè¾¹æ¸²æŸ“ï¼Œä¾§è¾¹æ åˆ†éš”çº¿ã€å¡ç‰‡è¾¹æ¡† |
| 1.3 | `text` èŠ‚ç‚¹æ”¯æŒçŸ¢é‡å­—ä½“ | â¬œ | `os/src/shell/river/KairoDisplay.zig` | æ›¿æ¢ 8x8 ä½å›¾å­—ä½“ï¼Œæ”¯æŒ Inter/JetBrains Mono |
| 1.4 | `text` èŠ‚ç‚¹æ”¯æŒç»†ç²’åº¦å­—å· | â¬œ | `os/src/shell/river/KairoDisplay.zig` | å½“å‰ä»…æ•´æ•° `scale`ï¼Œéœ€æ”¯æŒ px çº§å­—å· |
| 1.5 | èŠ‚ç‚¹ `id` å±æ€§æ”¯æŒ | â¬œ | `os/src/shell/river/KairoDisplay.zig` | å‘½ä¸­æµ‹è¯•å’Œ UI diff ä¾èµ–èŠ‚ç‚¹ ID |
| 1.6 | `action` å±æ€§æ‰©å±• | â¬œ | `os/src/shell/river/KairoDisplay.zig` | æ”¯æŒè‡ªå®šä¹‰ action å­—ç¬¦ä¸²ï¼ˆå¦‚ `launch_terminal`ï¼‰ |

---

## Phase 2ï¼šå“ç‰Œçª—å£å®ç°

æœ€ç®€å•çš„çª—å£ï¼Œé€‚åˆä½œä¸ºç¬¬ä¸€ä¸ªå®Œæ•´å®ç°ã€‚

| # | ä»»åŠ¡ | çŠ¶æ€ | æ–‡ä»¶ | è¯´æ˜ |
|---|------|------|------|------|
| 2.1 | åˆ›å»º BrandWindow TypeScript æ¨¡å— | â¬œ | `src/domains/ui/windows/brand.ts` | ç”Ÿæˆå“ç‰Œçª—å£ UI æ ‘ JSON |
| 2.2 | å®ç°ç³»ç»ŸçŠ¶æ€æ•°æ®é‡‡é›† | â¬œ | `src/domains/kernel/` | Agent çŠ¶æ€ã€å†…å­˜ã€è¿è¡Œæ—¶é—´ |
| 2.3 | å“ç‰Œçª—å£ UI æ ‘æ„å»º | â¬œ | `src/domains/ui/windows/brand.ts` | æŒ‰ `kdp-ui-trees.md` è§„èŒƒæ„å»º |
| 2.4 | å¿«é€Ÿå…¥å£å¡ç‰‡äº¤äº’ | â¬œ | `src/domains/ui/windows/brand.ts` | ç‚¹å‡» â†’ å¯åŠ¨ç»ˆç«¯/æ–‡ä»¶ç®¡ç†å™¨ |
| 2.5 | çŠ¶æ€é¢æ¿å®šæ—¶åˆ·æ–° | â¬œ | `src/domains/ui/windows/brand.ts` | æ¯ 2 ç§’æ›´æ–°ç³»ç»ŸçŠ¶æ€ |
| 2.6 | WM å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºå“ç‰Œçª—å£ | â¬œ | `os/src/wm/main.zig` | æ›¿æ¢å½“å‰ "Hello Kairo" ç¡¬ç¼–ç  |

---

## Phase 3ï¼šç»ˆç«¯çª—å£å®ç°

ä¾èµ–å·²æœ‰çš„ ShellManager å’Œç»ˆç«¯å·¥å…·ã€‚

| # | ä»»åŠ¡ | çŠ¶æ€ | æ–‡ä»¶ | è¯´æ˜ |
|---|------|------|------|------|
| 3.1 | åˆ›å»º TerminalWindow TypeScript æ¨¡å— | â¬œ | `src/domains/ui/windows/terminal.ts` | ç»ˆç«¯çª—å£ UI æ ‘ç”Ÿæˆå™¨ |
| 3.2 | PTY è¾“å‡º â†’ KDP UI æ ‘è½¬æ¢ | â¬œ | `src/domains/ui/windows/terminal.ts` | å°† ANSI è½¬ä¹‰åºåˆ—è§£æä¸º text èŠ‚ç‚¹ + é¢œè‰² |
| 3.3 | ç»ˆç«¯é…è‰²æ–¹æ¡ˆå®ç°ï¼ˆKairo Darkï¼‰ | â¬œ | `src/domains/ui/windows/terminal.ts` | 16 è‰² ANSI â†’ KDP RGBA æ˜ å°„ |
| 3.4 | å…‰æ ‡æ¸²æŸ“ä¸é—ªçƒ | â¬œ | `src/domains/ui/windows/terminal.ts` | ç«–çº¿å…‰æ ‡ï¼Œ800ms é—ªçƒå‘¨æœŸ |
| 3.5 | è„è¡Œè¿½è¸ªä¸å¢é‡æ›´æ–° | â¬œ | `src/domains/ui/windows/terminal.ts` | ä»…é‡ç»˜å˜åŒ–è¡Œï¼Œé¿å…å…¨é‡æäº¤ |
| 3.6 | æ ‡é¢˜æ  + æ ‡ç­¾æ æ¸²æŸ“ | â¬œ | `src/domains/ui/windows/terminal.ts` | è¿æ¥æŒ‡ç¤ºç¯ã€Shell é€‰æ‹©ã€å¤šæ ‡ç­¾ |
| 3.7 | çŠ¶æ€æ æ¸²æŸ“ | â¬œ | `src/domains/ui/windows/terminal.ts` | Shell ç±»å‹ã€ç¼–ç ã€è¡Œåˆ—å· |
| 3.8 | é”®ç›˜è¾“å…¥ â†’ PTY è½¬å‘ | â¬œ | KDP åè®®æ‰©å±• | éœ€è¦æ‰©å±•åè®®æ”¯æŒé”®ç›˜äº‹ä»¶ |
| 3.9 | KDP åè®®æ·»åŠ  `scroll` èŠ‚ç‚¹ | â¬œ | `os/src/shell/protocol/kairo-display-v1.xml` | ç»ˆç«¯æ»šåŠ¨ç¼“å†²åŒº |
| 3.10 | æ›´æ–°é¢‘ç‡æ§åˆ¶ï¼ˆ16ms/50ms åˆå¹¶ï¼‰ | â¬œ | `src/domains/ui/windows/terminal.ts` | é«˜é¢‘è¾“å‡ºé™çº§ç­–ç•¥ |

---

## Phase 4ï¼šæ–‡ä»¶ç®¡ç†å™¨å®ç°

æœ€å¤æ‚çš„çª—å£ï¼Œä¾èµ–æ›´å¤š KDP æ‰©å±•ã€‚

| # | ä»»åŠ¡ | çŠ¶æ€ | æ–‡ä»¶ | è¯´æ˜ |
|---|------|------|------|------|
| 4.1 | åˆ›å»º FileManagerWindow TypeScript æ¨¡å— | â¬œ | `src/domains/ui/windows/file-manager.ts` | æ–‡ä»¶ç®¡ç†å™¨ UI æ ‘ç”Ÿæˆå™¨ |
| 4.2 | æ–‡ä»¶ç³»ç»Ÿè¯»å–æœåŠ¡ | â¬œ | `src/domains/kernel/fs/` | ç›®å½•åˆ—è¡¨ã€æ–‡ä»¶å…ƒæ•°æ®ã€ç£ç›˜ç©ºé—´ |
| 4.3 | ä¾§è¾¹æ æ¸²æŸ“ï¼ˆæ”¶è—å¤¹/è®¾å¤‡/æ ‡ç­¾ï¼‰ | â¬œ | `src/domains/ui/windows/file-manager.ts` | å›ºå®š 220px å®½ï¼Œåˆ†ç»„åˆ—è¡¨ |
| 4.4 | å¯¼èˆªæ æ¸²æŸ“ï¼ˆè·¯å¾„é¢åŒ…å±‘ï¼‰ | â¬œ | `src/domains/ui/windows/file-manager.ts` | å‰è¿›/åé€€ + å¯ç‚¹å‡»è·¯å¾„ |
| 4.5 | ç½‘æ ¼è§†å›¾æ¸²æŸ“ | â¬œ | `src/domains/ui/windows/file-manager.ts` | 80Ã—96px æ–‡ä»¶é¡¹ï¼Œå›¾æ ‡ + æ–‡ä»¶å |
| 4.6 | åˆ—è¡¨è§†å›¾æ¸²æŸ“ | â¬œ | `src/domains/ui/windows/file-manager.ts` | åç§°/å¤§å°/æ—¥æœŸ/ç±»å‹ å››åˆ— |
| 4.7 | æ–‡ä»¶æ“ä½œï¼ˆæ‰“å¼€/é‡å‘½å/åˆ é™¤/å¤åˆ¶ï¼‰ | â¬œ | `src/domains/ui/windows/file-manager.ts` | é”®ç›˜å¿«æ·é”® + äº‹ä»¶å¤„ç† |
| 4.8 | å³é”®èœå•æ¸²æŸ“ | â¬œ | `src/domains/ui/windows/file-manager.ts` | æµ®å±‚èœå•ï¼ŒElevated èƒŒæ™¯ |
| 4.9 | KDP åè®®æ·»åŠ  `image` èŠ‚ç‚¹ | â¬œ | `os/src/shell/protocol/` + Zig | æ–‡ä»¶å›¾æ ‡å’Œç¼©ç•¥å›¾ |
| 4.10 | KDP åè®®æ·»åŠ  `input` èŠ‚ç‚¹ | â¬œ | `os/src/shell/protocol/` + Zig | æœç´¢æ¡†ã€é‡å‘½åè¾“å…¥ |
| 4.11 | KDP åè®®æ·»åŠ  `clip` èŠ‚ç‚¹ | â¬œ | `os/src/shell/protocol/` + Zig | ä¾§è¾¹æ å†…å®¹è£å‰ª |
| 4.12 | çŠ¶æ€æ æ¸²æŸ“ | â¬œ | `src/domains/ui/windows/file-manager.ts` | é¡¹ç›®è®¡æ•° + å¯ç”¨ç©ºé—´ |

---

## Phase 5ï¼šè®¾è®¡ç³»ç»ŸåŸºç¡€è®¾æ–½

è·¨çª—å£å…±äº«çš„è®¾è®¡ Token å’Œå·¥å…·å‡½æ•°ã€‚

| # | ä»»åŠ¡ | çŠ¶æ€ | æ–‡ä»¶ | è¯´æ˜ |
|---|------|------|------|------|
| 5.1 | è®¾è®¡ Token å¸¸é‡å®šä¹‰ | â¬œ | `src/domains/ui/tokens.ts` | é¢œè‰²ã€é—´è·ã€å­—å·çš„ KDP RGBA å¸¸é‡ |
| 5.2 | çª—å£æ¡†æ¶æ„å»ºå™¨ | â¬œ | `src/domains/ui/builders/window.ts` | æ ‡é¢˜æ  + æ§åˆ¶æŒ‰é’® + çŠ¶æ€æ é€šç”¨æ¨¡æ¿ |
| 5.3 | æ–‡æœ¬èŠ‚ç‚¹æ„å»ºå™¨ | â¬œ | `src/domains/ui/builders/text.ts` | æŒ‰å­—å·å±‚çº§ç”Ÿæˆ text èŠ‚ç‚¹ |
| 5.4 | äº¤äº’çŠ¶æ€ç®¡ç† | â¬œ | `src/domains/ui/state.ts` | Hover/Active/Focus/Selected çŠ¶æ€è¿½è¸ª |
| 5.5 | çª—å£ç”Ÿå‘½å‘¨æœŸç®¡ç† | â¬œ | `src/domains/ui/window-manager.ts` | åˆ›å»º/é”€æ¯/ç„¦ç‚¹åˆ‡æ¢ |

---

## Phase 6ï¼šKDP åè®®æ‰©å±•ï¼ˆé”®ç›˜/é¼ æ ‡ï¼‰

å®Œæ•´äº¤äº’éœ€è¦åè®®å±‚æ”¯æŒã€‚

| # | ä»»åŠ¡ | çŠ¶æ€ | æ–‡ä»¶ | è¯´æ˜ |
|---|------|------|------|------|
| 6.1 | åè®®æ·»åŠ  `key_event` | â¬œ | `kairo-display-v1.xml` | é”®ç›˜æŒ‰ä¸‹/é‡Šæ”¾äº‹ä»¶ |
| 6.2 | åè®®æ·»åŠ  `pointer_event` | â¬œ | `kairo-display-v1.xml` | é¼ æ ‡ç§»åŠ¨/æ»šè½®äº‹ä»¶ |
| 6.3 | åè®®æ·»åŠ  `focus_event` | â¬œ | `kairo-display-v1.xml` | Surface è·å¾—/å¤±å»ç„¦ç‚¹ |
| 6.4 | Zig å±‚å®ç°é”®ç›˜äº‹ä»¶è½¬å‘ | â¬œ | `KairoDisplay.zig` | libinput â†’ KDP äº‹ä»¶ |
| 6.5 | Zig å±‚å®ç°é¼ æ ‡ hover æ£€æµ‹ | â¬œ | `KairoDisplay.zig` | å‘½ä¸­æµ‹è¯• + hover çŠ¶æ€ |
| 6.6 | TypeScript å±‚äº‹ä»¶åˆ†å‘ | â¬œ | `src/domains/ui/` | äº‹ä»¶è·¯ç”±åˆ°å¯¹åº”çª—å£ |

---

## ä¾èµ–å…³ç³»

```
Phase 1ï¼ˆæ¸²æŸ“å™¨å¢å¼ºï¼‰
  â”œâ”€â”€ Phase 2ï¼ˆå“ç‰Œçª—å£ï¼‰â† æœ€å…ˆå¯äº¤ä»˜
  â”œâ”€â”€ Phase 5ï¼ˆè®¾è®¡åŸºç¡€è®¾æ–½ï¼‰â† ä¸ Phase 2 å¹¶è¡Œ
  â””â”€â”€ Phase 6ï¼ˆåè®®æ‰©å±•ï¼‰
       â”œâ”€â”€ Phase 3ï¼ˆç»ˆç«¯ï¼‰â† ä¾èµ–é”®ç›˜äº‹ä»¶
       â””â”€â”€ Phase 4ï¼ˆæ–‡ä»¶ç®¡ç†å™¨ï¼‰â† ä¾èµ–å›¾ç‰‡/è¾“å…¥/æ»šåŠ¨
```

## å»ºè®®å®æ–½é¡ºåº

```
1. Phase 5.1        è®¾è®¡ Tokenï¼ˆæ‰€æœ‰çª—å£çš„åŸºç¡€ï¼‰
2. Phase 1.5 + 1.6  èŠ‚ç‚¹ ID å’Œ action æ”¯æŒï¼ˆäº¤äº’åŸºç¡€ï¼‰
3. Phase 5.2        çª—å£æ¡†æ¶æ„å»ºå™¨
4. Phase 2 å…¨éƒ¨     å“ç‰Œçª—å£ï¼ˆç¬¬ä¸€ä¸ªå¯è§æˆæœï¼‰
5. Phase 1.1 + 1.2  åœ†è§’ + è¾¹æ¡†ï¼ˆè§†è§‰å®Œå–„ï¼‰
6. Phase 6.1~6.3    åè®®æ‰©å±•ï¼ˆäº¤äº’åŸºç¡€ï¼‰
7. Phase 3 å…¨éƒ¨     ç»ˆç«¯çª—å£
8. Phase 1.3 + 1.4  çŸ¢é‡å­—ä½“ï¼ˆç»ˆç«¯ä½“éªŒæå‡ï¼‰
9. Phase 4 å…¨éƒ¨     æ–‡ä»¶ç®¡ç†å™¨
```
